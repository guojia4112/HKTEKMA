
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>T-EKMA 图：NO₂ vs O₃</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #controls { margin-bottom: 20px; }
        input { margin-right: 10px; }
    </style>
</head>
<body>
    <h2>T-EKMA 图：NO₂ vs O₃（站点66过去24小时）</h2>
    <div id="controls">
        <input id="userX" type="number" placeholder="NO₂值">
        <input id="userY" type="number" placeholder="O₃值">
        <button onclick="plotUserPoint()">添加数据点</button>
    </div>
    <div id="plot" style="width:100%;height:600px;"></div>

    <script>
        let userPoints = [];

        function plotUserPoint() {
            let x = parseFloat(document.getElementById('userX').value);
            let y = parseFloat(document.getElementById('userY').value);
            if (!isNaN(x) && !isNaN(y)) {
                userPoints.push({ x: x, y: y });
                Plotly.addTraces('plot', {
                    x: userPoints.map(p => p.x),
                    y: userPoints.map(p => p.y),
                    mode: 'markers',
                    name: '你输入的数据点',
                    marker: { color: 'red', size: 12, symbol: 'diamond' }
                });
            } else {
                alert("请输入有效的NO₂和O₃值！");
            }
        }

        fetch('./data/past_24_pollutant.js')
            .then(response => response.text())
            .then(scriptText => {
                const script = document.createElement('script');
                script.textContent = scriptText;
                document.body.appendChild(script);

                if (typeof station_24_data === 'undefined') {
                    console.error('station_24_data 未定义');
                    return;
                }

                const station66Array = station_24_data.find(arr =>
                    arr.some(item => item.StationID === '66')
                );

                if (!station66Array) {
                    console.error('未找到站点 66 数据');
                    return;
                }

                const no2Values = station66Array.map(item => parseFloat(item.NO2));
                const o3Values = station66Array.map(item => parseFloat(item.O3));
                const timeLabels = station66Array.map(item => item.DateTime);

                Plotly.newPlot('plot', [{
                    x: no2Values,
                    y: o3Values,
                    mode: 'markers+text',
                    type: 'scatter',
                    text: timeLabels,
                    textposition: 'top center',
                    name: '站点66过去24小时',
                    marker: { color: 'green', size: 10 }
                }], {
                    title: 'T-EKMA 图：NO₂ vs O₃',
                    xaxis: { title: 'NO₂ (μg/m³)' },
                    yaxis: { title: 'O₃ (μg/m³)' }
                });
            })
            .catch(err => console.error('获取数据失败:', err));
        <script src="tekma.js"></script>

</body>
</html>
